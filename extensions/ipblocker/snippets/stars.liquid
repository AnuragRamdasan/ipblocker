{% assign shop_domain = shop.domain %}
<script>
  const shop = "{{ shop_domain }}";
  async function fetchCountries() {
    const response = await fetch("https://ipblocker.shopifyplugins.pro/countries?shop="+shop);
    const countries = await response.json();

    const data = await fetch("https://api.ipify.org?format=json")
    const ipData = await data.json()

    const countryData = await fetch('https://ipapi.co/' + ipData.ip + '/json/')
    const country = await countryData.json()

    const currentCountry = country["country_code"]
    const blockedCountries = countries.countries.map(c => c["countryCode"])

    if(blockedCountries.includes(currentCountry)) {
      alert("This website is not accessible in your country.")
    }
  }

  document.addEventListener('DOMContentLoaded', function() {
    // Product page specific JavaScript here
    fetchCountries()
  });
  
</script>